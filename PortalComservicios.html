<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Comservicios - Entalpia</title>
    <!-- Tailwind CSS (Dise帽o) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Iconos (FontAwesome) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Fuente Google -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        /* Animaciones del Modal */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.2s ease-out; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: all 0.2s ease-in; }
    </style>
</head>
<body class="bg-slate-100 h-screen flex overflow-hidden text-slate-800">

    <!-- SIDEBAR (Navegaci贸n Izquierda) -->
    <aside class="w-64 bg-slate-900 text-white flex flex-col shadow-2xl z-20 hidden md:flex">
        <div class="h-16 flex items-center px-6 border-b border-slate-700 bg-slate-800">
            <div>
                <h1 class="text-lg font-bold tracking-wider text-blue-400">ENTALPIA</h1>
                <span class="text-[10px] text-slate-400 uppercase tracking-widest">Portal Comservicios</span>
            </div>
        </div>

        <nav class="flex-1 py-6 px-3 space-y-1 overflow-y-auto" id="categoryNav">
            <!-- Se llena din谩micamente con JS -->
        </nav>

        <div class="p-4 border-t border-slate-700 bg-slate-800/50">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-sm font-bold shadow-lg">
                    OP
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium truncate">Operador Local</p>
                    <p class="text-xs text-slate-400 truncate">Modo Local Storage</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="flex-1 flex flex-col h-full overflow-hidden relative">
        
        <!-- HEADER -->
        <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-4 md:px-8 shadow-sm z-10">
            <div class="flex items-center gap-4 flex-1">
                <div class="md:hidden text-slate-900 font-bold">ENTALPIA</div>
                <div class="relative hidden md:block w-96">
                    <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input 
                        type="text" 
                        id="searchInput"
                        placeholder="Buscar aplicaci贸n, c贸digo o herramienta..." 
                        class="w-full pl-10 pr-4 py-2 bg-slate-100 border-none rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all"
                    >
                </div>
            </div>

            <div class="flex items-center gap-3">
                <button onclick="openModal()" class="hidden md:flex items-center gap-2 px-4 py-2 bg-slate-900 hover:bg-slate-800 text-white text-sm font-medium rounded-lg transition-all shadow-md active:transform active:scale-95">
                    <i class="fa-solid fa-plus"></i>
                    <span>Nueva App</span>
                </button>
                <button onclick="resetData()" class="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-full relative" title="Resetear datos de f谩brica">
                    <i class="fa-solid fa-rotate-right"></i>
                </button>
            </div>
        </header>

        <!-- AREA DE TRABAJO (GRID) -->
        <main class="flex-1 overflow-auto p-4 md:p-8 bg-slate-100">
            
            <div class="flex justify-between items-end mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-slate-800" id="pageTitle">Panel General</h2>
                    <p class="text-slate-500 mt-1">Acceso centralizado a recursos operativos.</p>
                </div>
                <!-- Bot贸n m贸vil -->
                <button onclick="openModal()" class="md:hidden w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 active:scale-95 transition-transform">
                    <i class="fa-solid fa-plus text-xl"></i>
                </button>
            </div>

            <!-- Contenedor de Tarjetas -->
            <div id="appsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-10">
                <!-- Las tarjetas se inyectan aqu铆 con JS -->
            </div>

            <!-- Estado Vac铆o (Oculto por defecto) -->
            <div id="emptyState" class="hidden flex flex-col items-center justify-center py-20 text-center bg-white rounded-xl border border-dashed border-slate-300">
                <div class="w-16 h-16 bg-slate-50 text-slate-300 rounded-full flex items-center justify-center mb-4">
                    <i class="fa-solid fa-layer-group text-2xl"></i>
                </div>
                <h3 class="text-lg font-medium text-slate-700">No hay herramientas aqu铆</h3>
                <p class="text-slate-500 max-w-sm mb-6">Parece que no hay aplicaciones en esta categor铆a o b煤squeda.</p>
                <button onclick="openModal()" class="text-blue-600 font-medium hover:underline">+ Agregar App</button>
            </div>
        </main>
    </div>

    <!-- MODAL (Agregar / Editar) -->
    <div id="appModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden transform transition-all duration-300 scale-95 opacity-0" id="modalContent">
            <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-lg font-bold text-slate-800" id="modalTitle">Vincular Nueva App</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 transition-colors">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            
            <form id="appForm" class="p-6 space-y-4">
                <input type="hidden" id="appId">
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">C贸digo</label>
                        <input type="text" id="appCode" required class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono bg-slate-50" placeholder="Ej: MANT-01">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Categor铆a</label>
                        <select id="appCategory" class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                            <option value="Mantenimiento">Mantenimiento</option>
                            <option value="SSOMA">SSOMA</option>
                            <option value="Administraci贸n">Administraci贸n</option>
                            <option value="Operaciones">Operaciones</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nombre Herramienta</label>
                    <input type="text" id="appTitle" required class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: Tablero de Control">
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">URL Destino</label>
                    <div class="flex">
                        <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-slate-200 bg-slate-50 text-gray-500 text-sm"><i class="fa-solid fa-link"></i></span>
                        <input type="url" id="appUrl" required class="flex-1 w-full px-3 py-2 border border-slate-200 rounded-r-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://...">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Descripci贸n</label>
                    <textarea id="appDesc" rows="2" class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" placeholder="Breve descripci贸n..."></textarea>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Icono</label>
                    <div class="flex gap-2 flex-wrap" id="iconSelector">
                        <!-- Iconos generados por JS -->
                    </div>
                    <input type="hidden" id="appIcon" value="fa-screwdriver-wrench">
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Estado</label>
                    <select id="appStatus" class="w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                        <option value="online"> Operativo (Online)</option>
                        <option value="maintenance"> En Mantenimiento</option>
                        <option value="offline"> Fuera de Servicio</option>
                    </select>
                </div>

                <div class="pt-4 flex gap-3 border-t border-slate-100 mt-2">
                    <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-slate-200 text-slate-600 rounded-lg hover:bg-slate-50 font-medium transition-colors">Cancelar</button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium shadow-lg shadow-blue-500/30 transition-all transform active:scale-95">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA INICIAL (Seed Data) ---
        const defaultApps = [
            { id: '1', code: 'MANT-01', title: 'Gesti贸n de OTs', description: 'Creaci贸n y cierre de 贸rdenes de trabajo.', url: '#', category: 'Mantenimiento', icon: 'fa-screwdriver-wrench', status: 'online' },
            { id: '2', code: 'INV-02', title: 'Inventario Repuestos', description: 'Control de stock en almac茅n central.', url: '#', category: 'Mantenimiento', icon: 'fa-boxes-stacked', status: 'online' },
            { id: '3', code: 'HSE-01', title: 'Reporte Incidentes', description: 'Registro de actos y condiciones inseguras.', url: '#', category: 'SSOMA', icon: 'fa-helmet-safety', status: 'online' },
            { id: '4', code: 'DASH-01', title: 'KPIs Operativos', description: 'Tableros PowerBI de disponibilidad.', url: '#', category: 'Operaciones', icon: 'fa-chart-pie', status: 'maintenance' }
        ];

        // --- ESTADO DE LA APP ---
        let apps = JSON.parse(localStorage.getItem('entalpia_apps')) || defaultApps;
        let currentFilter = 'Todos';
        let searchTerm = '';
        
        // --- CONFIGURACIN ---
        const categories = ['Todos', 'Mantenimiento', 'SSOMA', 'Administraci贸n', 'Operaciones'];
        const icons = [
            { id: 'fa-screwdriver-wrench', name: 'Llave' },
            { id: 'fa-helmet-safety', name: 'Casco' },
            { id: 'fa-file-contract', name: 'Documento' },
            { id: 'fa-chart-pie', name: 'Gr谩fico' },
            { id: 'fa-truck-fast', name: 'Cami贸n' },
            { id: 'fa-users', name: 'Usuarios' },
            { id: 'fa-database', name: 'Datos' },
            { id: 'fa-table-columns', name: 'Panel' }
        ];

        // --- INICIALIZACIN ---
        document.addEventListener('DOMContentLoaded', () => {
            renderSidebar();
            renderIconSelector();
            renderApps();
            
            // Event Listeners
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchTerm = e.target.value;
                renderApps();
            });

            document.getElementById('appForm').addEventListener('submit', handleFormSubmit);
        });

        // --- RENDERIZADO ---
        function renderSidebar() {
            const nav = document.getElementById('categoryNav');
            nav.innerHTML = categories.map(cat => `
                <button onclick="setFilter('${cat}')" 
                    class="w-full flex items-center px-3 py-2.5 rounded-lg transition-colors mb-1 ${currentFilter === cat ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}">
                    <i class="fa-solid ${getCategoryIcon(cat)} w-6 text-center text-sm mr-2"></i>
                    <span class="text-sm font-medium">${cat}</span>
                </button>
            `).join('');
        }

        function getCategoryIcon(cat) {
            if(cat === 'Todos') return 'fa-border-all';
            if(cat === 'Mantenimiento') return 'fa-screwdriver-wrench';
            if(cat === 'SSOMA') return 'fa-helmet-safety';
            if(cat === 'Administraci贸n') return 'fa-briefcase';
            return 'fa-industry';
        }

        function renderApps() {
            const grid = document.getElementById('appsGrid');
            const empty = document.getElementById('emptyState');
            const pageTitle = document.getElementById('pageTitle');

            // Filtrar
            const filtered = apps.filter(app => {
                const matchCat = currentFilter === 'Todos' || app.category === currentFilter;
                const matchSearch = app.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                    app.code.toLowerCase().includes(searchTerm.toLowerCase());
                return matchCat && matchSearch;
            });

            // Actualizar T铆tulo
            pageTitle.innerText = currentFilter === 'Todos' ? 'Panel General' : `M贸dulo ${currentFilter}`;

            if (filtered.length === 0) {
                grid.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            grid.innerHTML = filtered.map(app => `
                <div class="group bg-white rounded-xl border border-slate-200 hover:border-blue-300 card-hover transition-all duration-300 flex flex-col relative overflow-hidden h-60">
                    <!-- Status Bar -->
                    <div class="h-1.5 w-full bg-slate-100">
                        <div class="h-full w-full ${getStatusColor(app.status)}"></div>
                    </div>

                    <div class="p-6 flex-1 flex flex-col relative">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 rounded-xl ${getCategoryColor(app.category)}">
                                <i class="fa-solid ${app.icon} text-xl"></i>
                            </div>
                            <span class="text-[10px] font-bold tracking-wider text-slate-400 bg-slate-50 px-2 py-1 rounded border border-slate-100 font-mono">
                                ${app.code}
                            </span>
                        </div>
                        
                        <h3 class="font-bold text-slate-800 text-lg mb-1 truncate" title="${app.title}">${app.title}</h3>
                        <p class="text-xs text-slate-500 line-clamp-2 leading-relaxed">${app.description}</p>
                    </div>

                    <div class="bg-slate-50 px-6 py-3 border-t border-slate-100 flex items-center justify-between">
                        <div class="flex items-center gap-1 text-[10px] font-bold uppercase tracking-wide">
                             ${getStatusBadge(app.status)}
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity mr-2 scale-90">
                                <button onclick="editApp('${app.id}')" class="w-7 h-7 flex items-center justify-center bg-white rounded border border-slate-200 text-slate-400 hover:text-blue-600 hover:border-blue-300 transition-colors">
                                    <i class="fa-solid fa-pen text-xs"></i>
                                </button>
                                <button onclick="deleteApp('${app.id}')" class="w-7 h-7 flex items-center justify-center bg-white rounded border border-slate-200 text-slate-400 hover:text-red-600 hover:border-red-300 transition-colors">
                                    <i class="fa-solid fa-trash text-xs"></i>
                                </button>
                            </div>
                            
                            <a href="${app.url}" target="_blank" class="w-8 h-8 rounded-full bg-slate-900 text-white flex items-center justify-center hover:bg-blue-600 transition-colors shadow-lg shadow-blue-900/20 group-hover:scale-110 duration-200">
                                <i class="fa-solid fa-arrow-up-right-from-square text-xs"></i>
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- HELPERS VISUALES ---
        function getStatusColor(status) {
            if(status === 'online') return 'bg-emerald-500';
            if(status === 'maintenance') return 'bg-amber-500';
            return 'bg-red-500';
        }

        function getStatusBadge(status) {
            if(status === 'online') return '<span class="text-emerald-600"><i class="fa-solid fa-circle-check mr-1"></i>Activo</span>';
            if(status === 'maintenance') return '<span class="text-amber-600"><i class="fa-solid fa-triangle-exclamation mr-1"></i>Maint.</span>';
            return '<span class="text-red-600"><i class="fa-solid fa-circle-xmark mr-1"></i>Offline</span>';
        }

        function getCategoryColor(cat) {
            if(cat === 'Mantenimiento') return 'bg-blue-50 text-blue-600';
            if(cat === 'SSOMA') return 'bg-orange-50 text-orange-600';
            return 'bg-slate-100 text-slate-600';
        }

        function renderIconSelector() {
            const container = document.getElementById('iconSelector');
            container.innerHTML = icons.map(icon => `
                <button type="button" onclick="selectIcon('${icon.id}')" 
                    class="icon-btn p-2 rounded-md border border-slate-200 text-slate-400 hover:bg-slate-50 transition-all ${icon.id === 'fa-screwdriver-wrench' ? 'bg-blue-50 border-blue-500 text-blue-600' : ''}" 
                    data-icon="${icon.id}">
                    <i class="fa-solid ${icon.id} text-lg"></i>
                </button>
            `).join('');
        }

        // --- LGICA DE NEGOCIO ---
        function setFilter(cat) {
            currentFilter = cat;
            renderSidebar();
            renderApps();
        }

        function saveToStorage() {
            localStorage.setItem('entalpia_apps', JSON.stringify(apps));
            renderApps();
        }

        function resetData() {
            if(confirm('驴Restaurar datos de ejemplo? Se borrar谩n tus cambios.')){
                apps = defaultApps;
                saveToStorage();
            }
        }

        // --- MODAL & FORMULARIO ---
        function openModal() {
            document.getElementById('appModal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('modalContent').classList.remove('scale-95', 'opacity-0');
                document.getElementById('modalContent').classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // Reset Form for New
            document.getElementById('appId').value = '';
            document.getElementById('appForm').reset();
            document.getElementById('modalTitle').innerText = 'Vincular Nueva App';
            document.getElementById('appCode').value = 'APP-' + Math.floor(Math.random()*1000);
            selectIcon('fa-screwdriver-wrench');
        }

        function closeModal() {
            document.getElementById('modalContent').classList.remove('scale-100', 'opacity-100');
            document.getElementById('modalContent').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                document.getElementById('appModal').classList.add('hidden');
            }, 200);
        }

        function selectIcon(iconId) {
            document.getElementById('appIcon').value = iconId;
            document.querySelectorAll('.icon-btn').forEach(btn => {
                if(btn.dataset.icon === iconId) {
                    btn.classList.add('bg-blue-50', 'border-blue-500', 'text-blue-600');
                    btn.classList.remove('border-slate-200', 'text-slate-400');
                } else {
                    btn.classList.remove('bg-blue-50', 'border-blue-500', 'text-blue-600');
                    btn.classList.add('border-slate-200', 'text-slate-400');
                }
            });
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            const id = document.getElementById('appId').value;
            const newApp = {
                id: id || Date.now().toString(),
                code: document.getElementById('appCode').value,
                title: document.getElementById('appTitle').value,
                category: document.getElementById('appCategory').value,
                url: document.getElementById('appUrl').value,
                description: document.getElementById('appDesc').value,
                icon: document.getElementById('appIcon').value,
                status: document.getElementById('appStatus').value
            };

            if(id) {
                const index = apps.findIndex(a => a.id === id);
                apps[index] = newApp;
            } else {
                apps.push(newApp);
            }

            saveToStorage();
            closeModal();
        }

        function editApp(id) {
            const app = apps.find(a => a.id === id);
            if(!app) return;

            openModal();
            document.getElementById('modalTitle').innerText = 'Editar Herramienta';
            document.getElementById('appId').value = app.id;
            document.getElementById('appCode').value = app.code;
            document.getElementById('appTitle').value = app.title;
            document.getElementById('appCategory').value = app.category;
            document.getElementById('appUrl').value = app.url;
            document.getElementById('appDesc').value = app.description;
            document.getElementById('appStatus').value = app.status;
            selectIcon(app.icon);
        }

        function deleteApp(id) {
            if(confirm('驴Eliminar esta herramienta del portal?')) {
                apps = apps.filter(a => a.id !== id);
                saveToStorage();
            }
        }

        // Cerrar modal con clic afuera
        document.getElementById('appModal').addEventListener('click', (e) => {
            if(e.target.id === 'appModal') closeModal();
        });

    </script>
</body>
</html>
