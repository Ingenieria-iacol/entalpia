<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso Seguridad GLP | GasEngineering Hub</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body { 
            background-color: #0a0a0a; 
            color: #e5e5e5;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        .app-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-image: url('LogoEntalpia.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%;
            opacity: 0.04;
            pointer-events: none;
        }

        .login-watermark {
            background-image: url('LogoEntalpia.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.08;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #111; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #444; }
        
        .slide-enter { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilos para tablas técnicas */
        .tech-table th { background-color: #1e293b; color: #94a3b8; font-weight: 600; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; }
        .tech-table td { border-bottom: 1px solid #1e293b; color: #e2e8f0; }
        .tech-table tr:last-child td { border-bottom: none; }
    </style>
</head>
<body>
    <img id="logo-entalpia" src="LogoEntalpia.png" style="display: none;" alt="Logo Entalpia" crossorigin="anonymous" />
    <div class="app-background"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { jsPDF } = window.jspdf;

        const Icon = ({ name, size = 20, className = "" }) => {
            const iconData = lucide.icons[name];
            if (!iconData) return null;
            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width={size} height={size} viewBox="0 0 24 24" 
                    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" 
                    className={className}
                    dangerouslySetInnerHTML={{ __html: iconData.map(i => `<${i[0]} ${Object.entries(i[1]).map(([k,v]) => `${k}="${v}"`).join(' ')} />`).join('') }}
                />
            );
        };

        // --- COMPONENTE DE ONDA SONORA FUTURISTA ---
        const VoiceWaveform = ({ isPlaying, height = 100 }) => {
            const canvasRef = useRef(null);
            
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let animationFrameId;
                let phase = 0;
                
                const dpr = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                
                const draw = () => {
                    const w = rect.width;
                    const h = rect.height;
                    const centerY = h / 2;
                    
                    ctx.clearRect(0, 0, w, h);
                    
                    // Configuración de la onda futurista (Naranja/Amarillo para Gas)
                    const lines = 5; 
                    const baseAmplitude = isPlaying ? h * 0.3 : h * 0.02;
                    const speed = isPlaying ? 0.05 : 0.01; 
                    
                    phase += speed;
                    
                    // Paleta de colores cálida (Gas/Energía)
                    const colors = ["#f97316", "#fbbf24", "#fdba74", "#ea580c", "#fcd34d"];

                    for (let i = 0; i < lines; i++) {
                        ctx.beginPath();
                        ctx.lineWidth = 2;
                        ctx.strokeStyle = colors[i % colors.length];
                        ctx.globalAlpha = 0.7 - (i * 0.1); 
                        
                        ctx.shadowBlur = 10;
                        ctx.shadowColor = colors[i % colors.length];

                        for (let x = 0; x < w; x++) {
                            const frequency = 0.01 + (i * 0.002);
                            const amplitudeVariation = Math.sin(x * 0.05 + phase) * 0.3 + 0.7; 

                            const y = centerY + 
                                Math.sin(x * frequency + phase + i) * (baseAmplitude * amplitudeVariation) +
                                Math.cos(x * (frequency * 1.5) - phase * 0.5) * (baseAmplitude * 0.2);
                            
                            if (x === 0) ctx.moveTo(x, y);
                            else ctx.lineTo(x, y);
                        }
                        ctx.stroke();
                    }
                    
                    ctx.shadowBlur = 0;
                    animationFrameId = requestAnimationFrame(draw);
                };
                
                draw();
                
                return () => cancelAnimationFrame(animationFrameId);
            }, [isPlaying]);
            
            return <canvas ref={canvasRef} style={{ width: '100%', height: `${height}px` }} />;
        };

        // --- COMPONENTES GRÁFICOS SVG ---

        const TankDiagram = () => (
            <div className="bg-white p-4 rounded-lg w-full max-w-md mx-auto shadow-lg opacity-90 my-4">
                <p className="text-black text-xs font-bold text-center mb-2">Componentes del Tanque Estacionario</p>
                <svg viewBox="0 0 400 200" className="w-full h-auto border border-gray-200">
                    {/* Cuerpo del Tanque */}
                    <rect x="50" y="60" width="300" height="100" rx="30" ry="30" fill="#e5e7eb" stroke="#374151" strokeWidth="2" />
                    
                    {/* Patas */}
                    <rect x="80" y="160" width="20" height="20" fill="#374151" />
                    <rect x="300" y="160" width="20" height="20" fill="#374151" />

                    {/* Válvulas */}
                    <g transform="translate(100, 50)">
                        <rect x="0" y="0" width="20" height="10" fill="#ef4444" />
                        <line x1="10" y1="0" x2="10" y2="10" stroke="#991b1b" />
                        <text x="10" y="-5" fontSize="10" textAnchor="middle" fill="#ef4444">1. Alivio</text>
                    </g>

                    <g transform="translate(150, 50)">
                        <circle cx="10" cy="5" r="8" fill="#3b82f6" />
                        <text x="10" y="-5" fontSize="10" textAnchor="middle" fill="#3b82f6">6. Manómetro</text>
                    </g>

                    <g transform="translate(200, 50)">
                        <rect x="0" y="0" width="30" height="10" fill="#22c55e" />
                        <text x="15" y="-5" fontSize="10" textAnchor="middle" fill="#22c55e">3. Multiválvula</text>
                    </g>

                    <g transform="translate(260, 50)">
                        <rect x="0" y="0" width="15" height="10" fill="#eab308" />
                        <text x="7" y="-15" fontSize="10" textAnchor="middle" fill="#eab308">5. Llenado</text>
                    </g>

                    {/* Indicador Nivel */}
                    <g transform="translate(320, 100)">
                        <circle cx="0" cy="0" r="15" fill="white" stroke="#374151" />
                        <line x1="0" y1="0" x2="10" y2="-5" stroke="red" strokeWidth="2" />
                        <text x="25" y="5" fontSize="10" fill="#374151">4. %</text>
                    </g>

                    {/* Drenaje */}
                    <g transform="translate(200, 160)">
                        <rect x="0" y="0" width="10" height="10" fill="#6b7280" />
                        <text x="5" y="25" fontSize="10" textAnchor="middle" fill="#6b7280">2. Drenaje</text>
                    </g>
                </svg>
            </div>
        );

        const SafetyDistances = () => (
            <div className="bg-white p-4 rounded-lg w-full max-w-md mx-auto shadow-lg opacity-90 my-4">
                <p className="text-black text-xs font-bold text-center mb-2">Distancias Mínimas de Seguridad</p>
                <svg viewBox="0 0 300 200" className="w-full h-auto border border-gray-200">
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#333" />
                        </marker>
                    </defs>
                    
                    {/* Tanque Centro */}
                    <rect x="130" y="90" width="40" height="20" rx="5" fill="#3b82f6" />
                    <text x="150" y="105" fontSize="8" textAnchor="middle" fill="white">GLP</text>

                    {/* Material Combustible */}
                    <rect x="200" y="90" width="20" height="20" fill="#a855f7" />
                    <text x="210" y="125" fontSize="8" textAnchor="middle">Materiales</text>
                    <line x1="170" y1="100" x2="195" y2="100" stroke="#333" markerEnd="url(#arrow)" />
                    <text x="185" y="95" fontSize="8" textAnchor="middle">4m</text>

                    {/* Fuentes Calor */}
                    <circle cx="50" cy="100" r="10" fill="#f97316" />
                    <text x="50" y="125" fontSize="8" textAnchor="middle">Calor</text>
                    <line x1="65" y1="100" x2="125" y2="100" stroke="#333" markerEnd="url(#arrow)" />
                    <text x="95" y="95" fontSize="8" textAnchor="middle">10m</text>

                    {/* Llamas Abiertas */}
                    <path d="M 150 20 L 145 35 L 155 35 Z" fill="#ef4444" />
                    <text x="150" y="15" fontSize="8" textAnchor="middle">Fuego</text>
                    <line x1="150" y1="40" x2="150" y2="85" stroke="#333" markerEnd="url(#arrow)" />
                    <text x="165" y="60" fontSize="8" textAnchor="middle">15m</text>
                </svg>
            </div>
        );

        // --- CONTENIDO DEL CURSO (10 MÓDULOS) ---
        const courseModules = [
            {
                id: 1,
                title: "¿Qué es el GLP?",
                speech: "Bienvenido al curso de manejo seguro. El GLP, o Gas Licuado de Petróleo, es una mezcla de propano y butano. Es una energía limpia y potente. Lo más importante que debes saber es que se almacena en estado líquido dentro del tanque, pero tú lo consumes en estado gaseoso.",
                content: (
                    <div className="space-y-6">
                        <div className="border-l-4 border-orange-500 pl-4">
                            <h2 className="text-2xl font-bold text-white mb-2">Definición Básica</h2>
                            <p className="text-gray-300">El GLP se obtiene de la refinación del petróleo o separación del gas natural. Su gran ventaja es que almacena mucha energía en poco espacio.</p>
                        </div>
                        <div className="grid grid-cols-2 gap-4 text-center">
                            <div className="bg-[#1f2937] p-4 rounded-lg">
                                <Icon name="Droplet" className="text-blue-400 mx-auto mb-2" />
                                <h3 className="font-bold">Almacenamiento</h3>
                                <p className="text-xs text-gray-400 mt-1">Estado Líquido</p>
                            </div>
                            <div className="bg-[#1f2937] p-4 rounded-lg">
                                <Icon name="Wind" className="text-gray-400 mx-auto mb-2" />
                                <h3 className="font-bold">Consumo</h3>
                                <p className="text-xs text-gray-400 mt-1">Fase Vapor (Gas)</p>
                            </div>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿En qué estado se encuentra el GLP almacenado dentro del tanque estacionario?",
                    options: ["Gaseoso", "Líquido", "Sólido"],
                    correct: 1
                }
            },
            {
                id: 2,
                title: "Características de Seguridad",
                speech: "El GLP tiene propiedades únicas. Primero, no tiene olor natural, por eso le agregamos un químico llamado mercaptano para que huela fuerte si hay fuga. Segundo, es más pesado que el aire. Si escapa, no sube como el humo, sino que baja al suelo como el agua.",
                content: (
                    <div className="space-y-4">
                        <div className="bg-yellow-900/20 p-4 rounded-lg border border-yellow-600/50">
                            <h3 className="font-bold text-yellow-400 flex items-center gap-2"><Icon name="AlertTriangle"/> Mercaptano</h3>
                            <p className="text-sm mt-1">Aditivo químico que le da el "olor a gas" para identificar fugas rápidamente.</p>
                        </div>
                        
                        <div className="bg-blue-900/20 p-4 rounded-lg border border-blue-600/50">
                            <h3 className="font-bold text-blue-400 flex items-center gap-2"><Icon name="ArrowDown"/> Densidad</h3>
                            <p className="text-sm mt-1">Es más pesado que el aire. En caso de fuga, se acumula en zonas bajas (sótanos, desagües).</p>
                        </div>

                        <div className="bg-red-900/20 p-4 rounded-lg border border-red-600/50">
                            <h3 className="font-bold text-red-400 flex items-center gap-2"><Icon name="Flame"/> Expansión</h3>
                            <p className="text-sm mt-1">Al pasar de líquido a gas, aumenta su volumen 270 veces. ¡Mucha energía!</p>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "Si hay una fuga de GLP, ¿hacia dónde tiende a irse el gas?",
                    options: ["Sube rápidamente hacia el techo", "Se queda flotando en el medio", "Baja al nivel del suelo"],
                    correct: 2
                }
            },
            {
                id: 3,
                title: "El Tanque Estacionario",
                speech: "Conozcamos el equipo. El tanque tiene varias partes vitales. La válvula de alivio libera presión si sube mucho. El indicador de nivel nos dice cuánto gas queda. Y recuerda, por seguridad, un tanque nunca se debe llenar a más del 90%.",
                content: (
                    <div>
                        <p className="text-sm text-gray-300 mb-4">Es un recipiente de acero diseñado para almacenar GLP de forma segura. Identifique sus componentes:</p>
                        <TankDiagram />
                        <ul className="text-xs text-gray-400 list-disc pl-5 mt-4 space-y-1">
                            <li><strong>Válvula de Alivio:</strong> Libera exceso de presión para evitar explosiones.</li>
                            <li><strong>Indicador (Flotador):</strong> Muestra el porcentaje de llenado (Máx 90%).</li>
                            <li><strong>Multiválvula:</strong> Paso de gas a los equipos de consumo.</li>
                        </ul>
                    </div>
                ),
                quiz: {
                    q: "¿Cuál es el nivel máximo de llenado seguro para un tanque estacionario?",
                    options: ["80%", "90%", "100%"],
                    correct: 1
                }
            },
            {
                id: 4,
                title: "Cálculo de Volumen",
                speech: "El medidor te muestra un porcentaje, pero ¿cuántos galones tienes realmente? Es fácil. Multiplica la capacidad total del tanque por el porcentaje que ves, y divide por 100. Hagamos un ejemplo.",
                content: (
                    <div className="space-y-6">
                        <div className="bg-gray-800 p-6 rounded-xl text-center border border-gray-700">
                            <p className="text-xs uppercase tracking-wider text-gray-500 mb-2">Fórmula de Cálculo</p>
                            <div className="text-2xl font-mono text-white">
                                Vol = (Capacidad × %) / 100
                            </div>
                        </div>

                        <div className="bg-[#111] p-4 rounded-lg border border-orange-900/30">
                            <h4 className="font-bold text-orange-400 mb-2">Ejemplo Práctico</h4>
                            <ul className="text-sm space-y-2">
                                <li className="flex justify-between"><span>Capacidad Tanque:</span> <span>1000 Galones</span></li>
                                <li className="flex justify-between"><span>Indicador Marca:</span> <span>75%</span></li>
                                <li className="border-t border-gray-700 pt-2 mt-2 font-bold text-white flex justify-between">
                                    <span>Gas Disponible:</span> 
                                    <span>750 Galones</span>
                                </li>
                            </ul>
                            <p className="text-xs text-gray-500 mt-2 text-center">(1000 × 75) ÷ 100 = 750</p>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "Si tienes un tanque de 500 galones al 80%, ¿cuánto gas tienes?",
                    options: ["400 galones", "450 galones", "80 galones"],
                    correct: 0
                }
            },
            {
                id: 5,
                title: "Distancias de Seguridad",
                speech: "La ubicación del tanque no es capricho, es norma. Debe estar lejos de peligros. A 15 metros de cualquier fuego abierto, a 10 metros de fuentes de calor como motores, y a 4 metros de basura o materiales que puedan arder.",
                content: (
                    <div>
                        <p className="text-sm text-gray-300 mb-2">El tanque debe estar al aire libre y respetar las siguientes distancias mínimas:</p>
                        <SafetyDistances />
                        <div className="grid grid-cols-2 gap-2 text-xs mt-4">
                            <div className="bg-red-900/20 p-2 rounded text-center border border-red-800">
                                <strong className="block text-red-400 text-lg">15m</strong>
                                Llamas Abiertas
                            </div>
                            <div className="bg-orange-900/20 p-2 rounded text-center border border-orange-800">
                                <strong className="block text-orange-400 text-lg">10m</strong>
                                Fuentes de Calor
                            </div>
                            <div className="bg-blue-900/20 p-2 rounded text-center border border-blue-800">
                                <strong className="block text-blue-400 text-lg">6m</strong>
                                Otros Combustibles
                            </div>
                            <div className="bg-purple-900/20 p-2 rounded text-center border border-purple-800">
                                <strong className="block text-purple-400 text-lg">4m</strong>
                                Materiales Combustibles
                            </div>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿A qué distancia mínima debe estar el tanque de una llama abierta?",
                    options: ["4 metros", "10 metros", "15 metros"],
                    correct: 2
                }
            },
            {
                id: 6,
                title: "Prohibiciones Críticas",
                speech: "Hay cosas que NUNCA debes hacer. Está prohibido mover un tanque si tiene más del 5% de carga. Y lo más importante: está totalmente prohibido trasvasar gas de un tanque a otro o a cilindros. Eso es ilegal y peligroso.",
                content: (
                    <div className="space-y-4">
                        <div className="bg-red-600 text-white p-4 rounded-lg flex items-start gap-3 shadow-lg shadow-red-900/20">
                            <Icon name="XOctagon" size={32} className="flex-shrink-0" />
                            <div>
                                <h3 className="font-bold text-lg">PROHIBIDO TRASVASAR</h3>
                                <p className="text-sm opacity-90">Pasar gas de un tanque a otro o llenar cilindros portátiles manualmente es ilegal y extremadamente peligroso.</p>
                            </div>
                        </div>

                        <ul className="space-y-2 mt-4">
                            <li className="bg-[#1f2937] p-3 rounded flex items-center gap-3 border border-gray-700">
                                <Icon name="Move" className="text-orange-400" />
                                <span className="text-sm">No mover tanques con más del <strong>5% de carga</strong>.</span>
                            </li>
                            <li className="bg-[#1f2937] p-3 rounded flex items-center gap-3 border border-gray-700">
                                <Icon name="UserX" className="text-orange-400" />
                                <span className="text-sm">No permitir acceso a <strong>niños</strong> o personal no autorizado.</span>
                            </li>
                            <li className="bg-[#1f2937] p-3 rounded flex items-center gap-3 border border-gray-700">
                                <Icon name="Flame" className="text-orange-400" />
                                <span className="text-sm">No realizar <strong>quemas</strong> de basura cerca del área.</span>
                            </li>
                        </ul>
                    </div>
                ),
                quiz: {
                    q: "¿Se permite pasar gas del tanque estacionario a cilindros pequeños (trasvasar)?",
                    options: ["Sí, con cuidado", "Solo si está vacío", "No, está totalmente prohibido"],
                    correct: 2
                }
            },
            {
                id: 7,
                title: "Actuación ante Fugas",
                speech: "Si huele a gas pero no hay fuego, mantén la calma. No enciendas ni apagues luces o celulares, eso crea chispas. Cierra la válvula del tanque si es seguro, abre puertas y ventanas para ventilar y llama a emergencias.",
                content: (
                    <div className="space-y-4">
                        <h3 className="text-lg font-bold text-yellow-400 text-center mb-4">Protocolo: Fuga SIN Fuego</h3>
                        
                        <div className="grid grid-cols-1 gap-3">
                            <div className="flex items-center gap-3 bg-[#111] p-3 rounded border-l-4 border-green-500">
                                <div className="bg-green-900/30 p-2 rounded-full text-green-400">1</div>
                                <p className="text-sm"><strong>Elimine fuentes de ignición.</strong> No toque interruptores eléctricos.</p>
                            </div>
                            <div className="flex items-center gap-3 bg-[#111] p-3 rounded border-l-4 border-green-500">
                                <div className="bg-green-900/30 p-2 rounded-full text-green-400">2</div>
                                <p className="text-sm"><strong>Cierre la válvula</strong> de servicio del tanque (si es seguro acercarse).</p>
                            </div>
                            <div className="flex items-center gap-3 bg-[#111] p-3 rounded border-l-4 border-green-500">
                                <div className="bg-green-900/30 p-2 rounded-full text-green-400">3</div>
                                <p className="text-sm"><strong>Ventile el área</strong> para disipar el gas acumulado.</p>
                            </div>
                            <div className="flex items-center gap-3 bg-[#111] p-3 rounded border-l-4 border-green-500">
                                <div className="bg-green-900/30 p-2 rounded-full text-green-400">4</div>
                                <p className="text-sm">Si la nube es densa, use agua en forma de <strong>neblina</strong> para disiparla.</p>
                            </div>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "Si detectas una fuga de gas, ¿qué debes hacer con los interruptores de luz?",
                    options: ["Apagarlos inmediatamente", "Encenderlos para ver mejor", "No tocarlos (ni encender ni apagar)"],
                    correct: 2
                }
            },
            {
                id: 8,
                title: "Actuación ante Incendios",
                speech: "Si hay fuego, tu prioridad es tu vida. Evacúa. No intentes apagar la llama a menos que hayas cortado el flujo de gas, o podrías causar una explosión. Si puedes, echa agua al tanque para enfriarlo, pero no al fuego directamente.",
                content: (
                    <div className="space-y-4">
                        <div className="bg-red-900/30 p-4 rounded-lg border border-red-600 text-center animate-pulse">
                            <h3 className="text-xl font-bold text-red-500 mb-2">¡FUEGO EN EL TANQUE!</h3>
                            <p className="text-sm">Línea de Emergencia: <strong>123</strong> o <strong>01-8000-960888</strong></p>
                        </div>

                        <div className="space-y-3 mt-4">
                            <div className="flex gap-3">
                                <Icon name="ShieldAlert" className="text-red-400 flex-shrink-0" />
                                <p className="text-sm text-gray-300"><strong>NO APAGUE EL FUEGO</strong> si no ha cortado el flujo de gas. Una nube de gas sin quemar puede explotar.</p>
                            </div>
                            <div className="flex gap-3">
                                <Icon name="Droplets" className="text-blue-400 flex-shrink-0" />
                                <p className="text-sm text-gray-300">Aplique agua sobre la superficie del tanque para <strong>refrigerarlo</strong> y evitar sobrepresión.</p>
                            </div>
                            <div className="flex gap-3">
                                <Icon name="LogOut" className="text-green-400 flex-shrink-0" />
                                <p className="text-sm text-gray-300">Evacúe y aísle el área. Retire materiales combustibles cercanos.</p>
                            </div>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿Por qué no se debe apagar la llama si el gas sigue saliendo?",
                    options: ["Porque el agua daña el tanque", "Porque se puede formar una nube de gas explosiva", "Porque el fuego consume el gas"],
                    correct: 1
                }
            },
            {
                id: 9,
                title: "Recomendaciones Finales",
                speech: "Para terminar, recuerda que solo Colgas puede llenar tu tanque Colgas. Revisa el nivel periódicamente para no quedarte sin servicio. Y si te vas de viaje, cierra la válvula principal. El GLP es seguro si lo respetas.",
                content: (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-[#1f2937] p-4 rounded-lg border-t-4 border-blue-500">
                            <h4 className="font-bold text-white mb-2">Exclusividad</h4>
                            <p className="text-xs text-gray-400">El llenado es exclusivo del carro tanque de la empresa proveedora. No permita llenados por terceros.</p>
                        </div>
                        <div className="bg-[#1f2937] p-4 rounded-lg border-t-4 border-green-500">
                            <h4 className="font-bold text-white mb-2">Ausencias</h4>
                            <p className="text-xs text-gray-400">Si no usará sus equipos por un tiempo, cierre la válvula de servicio del tanque.</p>
                        </div>
                        <div className="bg-[#1f2937] p-4 rounded-lg border-t-4 border-yellow-500">
                            <h4 className="font-bold text-white mb-2">Pedidos</h4>
                            <p className="text-xs text-gray-400">Revise el nivel periódicamente. Haga su pedido con 24 horas de anticipación.</p>
                        </div>
                        <div className="bg-[#1f2937] p-4 rounded-lg border-t-4 border-purple-500">
                            <h4 className="font-bold text-white mb-2">Mantenimiento</h4>
                            <p className="text-xs text-gray-400">Solo personal técnico autorizado puede realizar reparaciones o modificaciones.</p>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿Quién es el único autorizado para llenar su tanque estacionario?",
                    options: ["Cualquier empresa de gas", "El carro tanque de la empresa proveedora (Colgas)", "Usted mismo"],
                    correct: 1
                }
            },
            {
                id: 10,
                title: "Certificación",
                speech: "¡Felicitaciones! Has completado el curso de seguridad en manejo de GLP. Ahora tienes el conocimiento para convivir de manera segura con este combustible. Descarga tu certificado a continuación.",
                content: (
                    <div className="text-center py-10">
                        <div className="w-24 h-24 bg-gradient-to-r from-orange-600 to-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl shadow-orange-500/20">
                            <Icon name="Award" size={48} className="text-white" />
                        </div>
                        <h2 className="text-3xl font-bold text-white mb-4">¡Capacitación Completada!</h2>
                        <p className="text-gray-400 mb-8 max-w-md mx-auto">Has adquirido los conocimientos fundamentales para el uso seguro y responsable del GLP.</p>
                    </div>
                ),
                quiz: null
            }
        ];

        function App() {
            const [currentStep, setCurrentStep] = useState(0); 
            const [completedSteps, setCompletedSteps] = useState([0]); 
            const [userName, setUserName] = useState("");
            const [userCedula, setUserCedula] = useState("");
            const [courseStarted, setCourseStarted] = useState(false);
            const [isPlaying, setIsPlaying] = useState(false);
            const [showQuiz, setShowQuiz] = useState(false);
            
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'es-ES'; 
                    const voices = window.speechSynthesis.getVoices();
                    const spanishVoice = voices.find(v => v.lang.includes('es') && (v.name.includes('Paulina') || v.name.includes('Monica') || v.name.includes('Helena') || v.name.includes('Google') || v.name.includes('Sabina')));
                    if (spanishVoice) utterance.voice = spanishVoice;

                    utterance.onstart = () => setIsPlaying(true);
                    utterance.onend = () => setIsPlaying(false);
                    utterance.onerror = () => setIsPlaying(false);
                    window.speechSynthesis.speak(utterance);
                }
            };

            const stopSpeech = () => {
                window.speechSynthesis.cancel();
                setIsPlaying(false);
            };

            useEffect(() => {
                if (courseStarted && courseModules[currentStep]) {
                    setShowQuiz(false); 
                    setTimeout(() => speak(courseModules[currentStep].speech), 500);
                }
                return () => stopSpeech();
            }, [currentStep, courseStarted]);

            const handleQuizSubmit = (isCorrect) => {
                if (isCorrect) {
                    const nextStep = currentStep + 1;
                    if (!completedSteps.includes(nextStep)) {
                        setCompletedSteps([...completedSteps, nextStep]);
                    }
                    if (nextStep < courseModules.length) {
                        setCurrentStep(nextStep);
                    }
                } else {
                    alert("Respuesta incorrecta. Es importante entender este concepto de seguridad. Repasemos.");
                    speak("La respuesta no es correcta. Por seguridad, repasemos el concepto. " + courseModules[currentStep].speech);
                    setShowQuiz(false); 
                }
            };

            const generatePDF = () => {
                const doc = new jsPDF({ orientation: "landscape", unit: "mm", format: "a4" });
                
                doc.setFillColor(15, 23, 42); 
                doc.rect(0, 0, 297, 210, 'F');

                try {
                    const img = document.getElementById('logo-entalpia');
                    if (img) {
                        const canvas = document.createElement("canvas");
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        const ctx = canvas.getContext("2d");
                        
                        ctx.globalAlpha = 0.1; 
                        ctx.drawImage(img, 0, 0);
                        
                        const pageWidth = 297;
                        const pageHeight = 210;
                        const imgWidth = pageWidth * 0.75;
                        const imgHeight = (img.naturalHeight / img.naturalWidth) * imgWidth;
                        
                        const x = (pageWidth - imgWidth) / 2;
                        const y = (pageHeight - imgHeight) / 2;

                        doc.addImage(canvas.toDataURL("image/png"), 'PNG', x, y, imgWidth, imgHeight, undefined, 'FAST');
                    }
                } catch(e) {}

                doc.setLineWidth(1.5);
                doc.setDrawColor(249, 115, 22); // Orange border for Gas
                doc.rect(15, 15, 267, 180);
                
                doc.setTextColor(255, 255, 255);
                doc.setFont("helvetica", "bold");
                doc.setFontSize(36);
                doc.text("CONSTANCIA DE CAPACITACIÓN", 148.5, 55, { align: "center" });
                
                doc.setFontSize(14);
                doc.setTextColor(148, 163, 184); 
                doc.text("GasEngineering Hub certifica que:", 148.5, 75, { align: "center" });
                
                doc.setFontSize(30);
                doc.setTextColor(251, 146, 60); // Orange
                doc.text(userName.toUpperCase(), 148.5, 95, { align: "center" });
                
                doc.setFontSize(16);
                doc.setTextColor(255, 255, 255);
                doc.text(`ID: ${userCedula}`, 148.5, 108, { align: "center" });
                
                doc.setFontSize(18);
                doc.setTextColor(200, 200, 200);
                doc.text("Ha recibido y comprendido la instrucción sobre:", 148.5, 130, { align: "center" });
                
                doc.setFont("helvetica", "bold");
                doc.setFontSize(22);
                doc.text("Seguridad y Manejo de GLP en Tanques Estacionarios", 148.5, 145, { align: "center" });
                
                doc.setFontSize(12);
                doc.setFont("helvetica", "normal");
                doc.setTextColor(148, 163, 184);
                doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 148.5, 165, { align: "center" });
                doc.text("Con el respaldo técnico de ENTALPIA", 148.5, 180, { align: "center" });

                doc.save(`Certificado_Seguridad_GLP_${userName}.pdf`);
            };

            if (!courseStarted) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
                         <div className="absolute inset-0 login-watermark z-0"></div>
                         <div className="bg-[#111]/90 backdrop-blur-xl p-8 rounded-2xl shadow-2xl max-w-md w-full border border-gray-800 relative z-10">
                            <div className="w-20 h-20 bg-gradient-to-br from-orange-600 to-yellow-500 rounded-2xl rotate-3 flex items-center justify-center mx-auto mb-8 shadow-2xl shadow-orange-900/40">
                                <Icon name="Flame" size={40} className="text-white -rotate-3" />
                            </div>
                            <h1 className="text-3xl font-bold text-center mb-2 text-white">Seguridad GLP</h1>
                            <p className="text-center text-orange-400 text-sm font-semibold tracking-wider mb-8 uppercase">Capacitación de Usuarios</p>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="text-xs text-gray-500 font-bold ml-1 uppercase">Nombre Completo</label>
                                    <input type="text" className="w-full bg-[#0a0a0a] border border-gray-700 rounded-lg p-3 text-white focus:border-orange-500 outline-none transition-colors" 
                                        value={userName} onChange={e => setUserName(e.target.value)} />
                                </div>
                                <div>
                                    <label className="text-xs text-gray-500 font-bold ml-1 uppercase">Cédula / ID</label>
                                    <input type="number" className="w-full bg-[#0a0a0a] border border-gray-700 rounded-lg p-3 text-white focus:border-orange-500 outline-none transition-colors" 
                                        value={userCedula} onChange={e => setUserCedula(e.target.value)} />
                                </div>
                                <button 
                                    onClick={() => (userName.length > 3 && userCedula.length > 4) ? setCourseStarted(true) : alert("Complete sus datos")}
                                    className="w-full bg-orange-600 hover:bg-orange-500 py-4 rounded-lg font-bold text-white transition-all shadow-lg shadow-orange-900/20 mt-4 flex items-center justify-center gap-2 group"
                                >
                                    Iniciar Capacitación <Icon name="ArrowRight" size={18} className="group-hover:translate-x-1 transition-transform"/>
                                </button>
                            </div>
                         </div>
                    </div>
                );
            }

            const activeModule = courseModules[currentStep];

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* SIDEBAR */}
                    <aside className="w-80 bg-[#080808] border-r border-gray-900 hidden md:flex flex-col z-20">
                        <div className="p-6 border-b border-gray-900 flex items-center gap-3">
                            <div className="w-10 h-10 bg-orange-600 rounded-lg flex items-center justify-center font-bold shadow-lg shadow-orange-900/20">GE</div>
                            <div>
                                <h1 className="font-bold text-white leading-tight">GasEngineering</h1>
                                <p className="text-xs text-orange-500 font-medium">Safety Training</p>
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-1 custom-scrollbar">
                            {courseModules.map((mod, idx) => {
                                const isUnlocked = completedSteps.includes(idx);
                                const isCurrent = idx === currentStep;
                                const isCompleted = completedSteps.includes(idx + 1);

                                return (
                                    <button 
                                        key={mod.id} 
                                        onClick={() => isUnlocked && setCurrentStep(idx)}
                                        className={`w-full p-3 rounded-lg text-sm flex items-center gap-3 transition-all text-left ${isCurrent ? 'bg-orange-900/20 border border-orange-800 text-orange-200' : 'hover:bg-[#111] text-gray-400'} ${!isUnlocked ? 'opacity-40 cursor-not-allowed' : ''}`}
                                    >
                                        <div className={`w-6 h-6 rounded flex items-center justify-center flex-shrink-0 text-[10px] font-bold ${isCompleted ? 'bg-green-500/20 text-green-400' : isCurrent ? 'bg-orange-500 text-white' : 'bg-gray-800'}`}>
                                            {isCompleted ? <Icon name="Check" size={12} /> : idx + 1}
                                        </div>
                                        <div className="flex-1 truncate font-medium">{mod.title}</div>
                                        {!isUnlocked && <Icon name="Lock" size={12} />}
                                    </button>
                                )
                            })}
                        </div>
                        <div className="p-4 bg-[#050505] border-t border-gray-900">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-gray-700 to-gray-600 flex items-center justify-center text-xs font-bold text-white">
                                    {userName.substring(0,2).toUpperCase()}
                                </div>
                                <div className="overflow-hidden">
                                    <p className="text-sm font-bold text-gray-200 truncate">{userName}</p>
                                    <p className="text-[10px] text-gray-500 truncate">ID: {userCedula}</p>
                                </div>
                            </div>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 flex flex-col relative z-10 bg-[#0a0a0a]">
                        {/* Header */}
                        <header className="px-6 py-4 border-b border-gray-900 flex justify-between items-center bg-[#0a0a0a]/80 backdrop-blur-md sticky top-0 z-30">
                            <div>
                                <p className="text-xs text-orange-500 font-bold uppercase tracking-wider mb-1">Módulo Actual</p>
                                <h2 className="font-bold text-xl text-white truncate max-w-md">{activeModule.title}</h2>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="relative w-20 h-10 overflow-hidden">
                                    <VoiceWaveform isPlaying={isPlaying} height={40} />
                                </div>
                                <div className="hidden sm:block text-right">
                                    <div className="font-bold text-sm text-gray-200">Instructor IA</div>
                                    <button onClick={() => isPlaying ? stopSpeech() : speak(activeModule.speech)} className="text-xs text-orange-400 hover:text-orange-300 flex items-center justify-end gap-1 mt-1">
                                        {isPlaying ? <><Icon name="Pause" size={10}/> Pausar</> : <><Icon name="Play" size={10}/> Reproducir</>}
                                    </button>
                                </div>
                            </div>
                        </header>

                        {/* Content Scroll */}
                        <div className="flex-1 overflow-y-auto p-6 md:p-12 custom-scrollbar flex flex-col items-center">
                            <div className="max-w-4xl w-full slide-enter key={currentStep}">
                                
                                {/* BANNER GRANDE (Onda Sonora) */}
                                <div className="w-full h-40 md:h-56 relative mb-6 rounded-xl overflow-hidden shadow-2xl border border-gray-800 group bg-[#050505]">
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <VoiceWaveform isPlaying={isPlaying} height={200} />
                                    </div>
                                    <div className="absolute inset-0 bg-gradient-to-t from-[#0a0a0a] via-transparent to-transparent"></div>
                                    <div className="absolute bottom-4 left-6">
                                        <span className="text-orange-400 text-xs font-bold uppercase tracking-wider bg-orange-900/20 px-2 py-1 rounded backdrop-blur-md border border-orange-500/20">
                                            IA Safety
                                        </span>
                                        <h2 className="text-2xl font-bold text-white mt-1 drop-shadow-md">
                                            Instructor Virtual
                                        </h2>
                                    </div>
                                </div>

                                <div className={`transition-all duration-500 ${showQuiz ? 'opacity-30 pointer-events-none blur-sm' : 'opacity-100'}`}>
                                    {activeModule.content}
                                    
                                    <div className="mt-12 flex justify-end border-t border-gray-800 pt-8">
                                        {activeModule.quiz ? (
                                            <button 
                                                onClick={() => { stopSpeech(); setShowQuiz(true); }}
                                                className="bg-orange-600 hover:bg-orange-500 text-white px-8 py-4 rounded-xl font-bold flex items-center gap-3 shadow-xl hover:shadow-orange-900/30 transition-all transform hover:-translate-y-1"
                                            >
                                                Validar Conocimiento <Icon name="ArrowRight" size={20} />
                                            </button>
                                        ) : (
                                            <button 
                                                onClick={generatePDF}
                                                className="bg-green-600 hover:bg-green-500 text-white px-8 py-4 rounded-xl font-bold flex items-center gap-3 shadow-xl hover:shadow-green-900/30 transition-all transform hover:-translate-y-1 animate-pulse"
                                            >
                                                Descargar Constancia <Icon name="Download" size={20} />
                                            </button>
                                        )}
                                    </div>
                                </div>

                            </div>
                        </div>

                        {/* Quiz Modal Overlay */}
                        {showQuiz && activeModule.quiz && (
                            <div className="absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm slide-enter">
                                <div className="bg-[#111] p-8 rounded-2xl border border-gray-800 shadow-2xl max-w-2xl w-full relative">
                                    <button onClick={() => setShowQuiz(false)} className="absolute top-4 right-4 text-gray-500 hover:text-white"><Icon name="X" /></button>
                                    
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="p-3 bg-orange-900/30 rounded-lg text-orange-400"><Icon name="HelpCircle" size={24} /></div>
                                        <div>
                                            <p className="text-xs text-orange-400 font-bold uppercase tracking-wider">Evaluación de Progreso</p>
                                            <h3 className="text-xl font-bold text-white">Pregunta de Control</h3>
                                        </div>
                                    </div>

                                    <h4 className="text-lg text-gray-200 mb-8 font-medium leading-relaxed">{activeModule.quiz.q}</h4>

                                    <div className="space-y-3">
                                        {activeModule.quiz.options.map((opt, idx) => (
                                            <button 
                                                key={idx}
                                                onClick={() => handleQuizSubmit(idx === activeModule.quiz.correct)}
                                                className="w-full text-left p-5 rounded-xl bg-[#1a1a1a] border border-gray-800 hover:border-orange-500 hover:bg-orange-900/10 transition-all flex justify-between items-center group"
                                            >
                                                <span className="text-gray-300 group-hover:text-white">{opt}</span>
                                                <div className="w-6 h-6 rounded-full border border-gray-600 group-hover:border-orange-500 flex items-center justify-center">
                                                    <div className="w-3 h-3 rounded-full bg-orange-500 opacity-0 group-hover:opacity-100 transition-opacity" />
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
