<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificación NTC 3833 Nral 5 - Entalpia</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Estilos base consistentes */
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
        }

        .bg-watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: url('LogoEntalpia.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 500px;
            opacity: 0.15;
            pointer-events: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Efectos Metálicos */
        .metallic-text {
            background: linear-gradient(to right, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .glow-box {
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.1);
        }

        /* Checkbox personalizado */
        .custom-checkbox:checked {
            background-color: #06b6d4;
            border-color: #06b6d4;
        }

        /* Animaciones */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.4s ease-out forwards;
        }
    </style>
</head>
<body class="min-h-screen relative font-sans">

    <div class="bg-watermark"></div>

    <div class="max-w-4xl mx-auto p-4 md:p-8 space-y-8">
        
        <!-- Header -->
        <header class="bg-gray-800/80 backdrop-blur-md p-6 rounded-2xl shadow-2xl border-l-4 border-cyan-500 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-cyan-500/10 rounded-full blur-3xl pointer-events-none"></div>
            <div class="flex items-start justify-between relative z-10">
                <div>
                    <h1 class="text-2xl md:text-3xl font-extrabold flex items-center gap-3">
                        <i data-lucide="clipboard-check" class="w-8 h-8 text-cyan-400"></i>
                        <span class="metallic-text tracking-tight">Protocolo de Verificación</span>
                    </h1>
                    <p class="text-slate-400 mt-2 text-sm font-medium">
                        NTC 3833 Numeral 5 - Verificaciones a Artefacto Instalado
                    </p>
                </div>
            </div>
        </header>

        <main class="space-y-6">

            <!-- Paso 1: Condiciones Previas (Checklist) -->
            <section class="bg-gray-800/90 rounded-2xl shadow-xl border border-gray-700/50 overflow-hidden">
                <div class="p-4 bg-gradient-to-r from-blue-900/40 to-cyan-900/40 border-b border-gray-700 flex items-center justify-between">
                    <h2 class="font-bold text-lg text-white flex items-center gap-2">
                        <span class="bg-cyan-500 text-black text-xs font-bold px-2 py-0.5 rounded-full">PASO 1</span>
                        Condiciones de Puesta en Marcha
                    </h2>
                    <span id="progress-text" class="text-xs font-mono text-cyan-400">0/5 Completado</span>
                </div>

                <div class="p-6 space-y-4">
                    <p class="text-sm text-slate-400 mb-4">Marque cada casilla para confirmar que se ha realizado la operación antes de la prueba final.</p>
                    
                    <div id="checklist-container" class="space-y-3">
                        <!-- Items generados por JS -->
                    </div>
                </div>
            </section>

            <!-- Paso 2: Prueba de Revoco (Oculto hasta completar paso 1) -->
            <section id="step-2-section" class="bg-gray-800/90 rounded-2xl shadow-xl border border-gray-700/50 overflow-hidden transition-all duration-500 opacity-50 pointer-events-none grayscale">
                <div class="p-4 bg-gradient-to-r from-blue-900/40 to-cyan-900/40 border-b border-gray-700">
                    <h2 class="font-bold text-lg text-white flex items-center gap-2">
                        <span class="bg-gray-600 text-gray-300 text-xs font-bold px-2 py-0.5 rounded-full transition-colors" id="step-2-badge">PASO 2</span>
                        Verificación de Revoco y Hermeticidad
                    </h2>
                </div>

                <div class="p-6 space-y-6">
                    <div class="bg-blue-900/20 p-4 rounded-xl border border-blue-500/20 text-sm text-blue-200 flex items-start gap-3">
                        <i data-lucide="flame" class="w-5 h-5 text-orange-400 mt-0.5"></i>
                        <p>Los artefactos deben llevar encendidos al menos <strong>5 minutos a máxima potencia</strong> antes de iniciar esta verificación (Verificado en Paso 1).</p>
                    </div>

                    <!-- Selector de Método -->
                    <div class="space-y-3">
                        <label class="text-xs font-bold text-slate-400 uppercase tracking-wide">Seleccione Metodología (Numeral 1.6)</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="selectMethod('mirror')" id="btn-mirror" class="p-4 rounded-xl border border-gray-600 bg-gray-700/50 hover:bg-gray-700 hover:border-cyan-500/50 transition-all flex flex-col items-center gap-2 group">
                                <i data-lucide="search" class="w-8 h-8 text-slate-400 group-hover:text-cyan-400"></i>
                                <span class="font-semibold text-slate-200">Espejo / Tubo de Humo</span>
                                <span class="text-xs text-slate-500 text-center">Visual (Nral 1.6.1)</span>
                            </button>
                            
                            <button onclick="selectMethod('analyzer')" id="btn-analyzer" class="p-4 rounded-xl border border-gray-600 bg-gray-700/50 hover:bg-gray-700 hover:border-cyan-500/50 transition-all flex flex-col items-center gap-2 group">
                                <i data-lucide="activity" class="w-8 h-8 text-slate-400 group-hover:text-cyan-400"></i>
                                <span class="font-semibold text-slate-200">Analizador de Gases</span>
                                <span class="text-xs text-slate-500 text-center">Medición CO (Nral 1.6.2)</span>
                            </button>
                        </div>
                    </div>

                    <!-- Área de Resultado Dinámica -->
                    <div id="result-input-area" class="hidden animate-slide-up bg-gray-900/50 p-6 rounded-xl border border-gray-700">
                        <!-- Contenido inyectado por JS -->
                    </div>

                    <!-- Veredicto Final -->
                    <div id="final-verdict" class="hidden">
                        <!-- Contenido inyectado por JS -->
                    </div>

                </div>
            </section>

        </main>
    </div>

    <script>
        // Datos del checklist (Numerales 1.1 a 1.5)
        const checklistItems = [
            { id: '1.1', text: 'Ajuste de presión de suministro según fabricante.' },
            { id: '1.2', text: 'Reglaje y ajuste del artefacto según fabricante.' },
            { id: '1.4', text: 'Cierre de puertas y ventanas (excepto ventilación NTC 3631).' },
            { id: '1.3', text: 'Encendido del artefacto a evaluar (Máx. Potencia por > 5 min).' },
            { id: '1.5', text: 'Encendido de TODOS los demás artefactos a gas del recinto (Máx. Potencia por > 5 min).' }
        ];

        let checklistState = new Array(checklistItems.length).fill(false);
        let currentMethod = null;

        // Inicialización
        document.addEventListener('DOMContentLoaded', () => {
            renderChecklist();
            lucide.createIcons();
        });

        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = checklistItems.map((item, index) => `
                <label class="flex items-start gap-3 p-3 rounded-lg border border-transparent hover:bg-gray-700/30 transition-colors cursor-pointer group">
                    <input type="checkbox" 
                        class="mt-1 w-5 h-5 rounded border-gray-500 bg-gray-700 text-cyan-500 focus:ring-cyan-500 focus:ring-offset-gray-800 custom-checkbox"
                        onchange="updateChecklist(${index}, this.checked)">
                    <div>
                        <span class="font-bold text-cyan-500 text-xs mr-2">[${item.id}]</span>
                        <span class="text-sm text-slate-300 group-hover:text-white transition-colors">${item.text}</span>
                    </div>
                </label>
            `).join('');
        }

        function updateChecklist(index, checked) {
            checklistState[index] = checked;
            const completedCount = checklistState.filter(Boolean).length;
            const total = checklistState.length;
            
            // Actualizar texto de progreso
            document.getElementById('progress-text').innerText = `${completedCount}/${total} Completado`;

            // Activar Paso 2 si todo está OK
            const step2 = document.getElementById('step-2-section');
            const step2Badge = document.getElementById('step-2-badge');

            if (completedCount === total) {
                step2.classList.remove('opacity-50', 'pointer-events-none', 'grayscale');
                step2Badge.classList.remove('bg-gray-600', 'text-gray-300');
                step2Badge.classList.add('bg-cyan-500', 'text-black');
            } else {
                step2.classList.add('opacity-50', 'pointer-events-none', 'grayscale');
                step2Badge.classList.add('bg-gray-600', 'text-gray-300');
                step2Badge.classList.remove('bg-cyan-500', 'text-black');
                // Resetear paso 2 si se desmarca algo
                resetStep2();
            }
        }

        function resetStep2() {
            currentMethod = null;
            document.getElementById('result-input-area').classList.add('hidden');
            document.getElementById('final-verdict').classList.add('hidden');
            document.getElementById('btn-mirror').classList.remove('ring-2', 'ring-cyan-500', 'bg-gray-700');
            document.getElementById('btn-analyzer').classList.remove('ring-2', 'ring-cyan-500', 'bg-gray-700');
        }

        function selectMethod(method) {
            currentMethod = method;
            const area = document.getElementById('result-input-area');
            const btnMirror = document.getElementById('btn-mirror');
            const btnAnalyzer = document.getElementById('btn-analyzer');

            // Reset estilos botones
            btnMirror.classList.remove('ring-2', 'ring-cyan-500', 'bg-gray-700');
            btnAnalyzer.classList.remove('ring-2', 'ring-cyan-500', 'bg-gray-700');

            // Activar botón seleccionado
            if (method === 'mirror') btnMirror.classList.add('ring-2', 'ring-cyan-500', 'bg-gray-700');
            else btnAnalyzer.classList.add('ring-2', 'ring-cyan-500', 'bg-gray-700');

            area.classList.remove('hidden');
            
            // Renderizar contenido según método
            if (method === 'mirror') {
                area.innerHTML = `
                    <h3 class="text-white font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="search" class="w-5 h-5 text-cyan-400"></i>
                        Inspección Visual (Espejo / Humo)
                    </h3>
                    <p class="text-sm text-slate-400 mb-4">
                        Ubique el espejo cromado o el tubo detector en la unión del collarín. Verifique si existe condensación (empañamiento) o desviación del humo hacia el recinto.
                    </p>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="showVerdict(true)" class="p-3 bg-red-900/30 border border-red-500/30 hover:bg-red-900/50 hover:border-red-500 rounded-lg text-red-200 transition-all font-semibold">
                            <i data-lucide="x-circle" class="inline w-4 h-4 mr-1"></i> Se observa Revoco
                        </button>
                        <button onclick="showVerdict(false)" class="p-3 bg-green-900/30 border border-green-500/30 hover:bg-green-900/50 hover:border-green-500 rounded-lg text-green-200 transition-all font-semibold">
                            <i data-lucide="check-circle" class="inline w-4 h-4 mr-1"></i> Sin Revoco (Hermético)
                        </button>
                    </div>
                `;
            } else {
                area.innerHTML = `
                    <h3 class="text-white font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="activity" class="w-5 h-5 text-cyan-400"></i>
                        Medición de Monóxido (Analizador)
                    </h3>
                    <p class="text-sm text-slate-400 mb-4">
                        Establezca la cantidad de CO corregido (libre de aire y vapor de agua) en el ambiente.
                    </p>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 mb-1">Lectura CO Ambiente (ppm)</label>
                            <input type="number" id="co-reading" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none" placeholder="0">
                        </div>
                        <button onclick="evaluateCO()" class="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-lg shadow-lg shadow-cyan-500/20 transition-all">
                            Registrar Lectura
                        </button>
                    </div>
                `;
            }
            lucide.createIcons();
            document.getElementById('final-verdict').classList.add('hidden');
        }

        function evaluateCO() {
            const reading = document.getElementById('co-reading').value;
            if (reading === '') return;
            // Interpretación simple: si hay lectura significativa, advertir.
            // La norma 3833 Nral 5 no da límite explícito, pero el objetivo es verificar "Ausencia".
            const val = parseFloat(reading);
            const isRevoco = val > 0; // Estricto: cualquier CO ambiente sugiere fuga/revoco
            showVerdict(isRevoco, val);
        }

        function showVerdict(isRevoco, value = null) {
            const container = document.getElementById('final-verdict');
            container.classList.remove('hidden');
            
            if (isRevoco) {
                container.innerHTML = `
                    <div class="p-4 bg-red-900/20 border border-red-500/50 rounded-xl flex items-start gap-4 animate-slide-up">
                        <div class="bg-red-500/20 p-2 rounded-full">
                            <i data-lucide="alert-triangle" class="w-8 h-8 text-red-500"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-red-400">NO CUMPLE</h3>
                            <p class="text-red-200 text-sm mt-1">
                                Se detectó revoco o fugas en el sistema de evacuación.
                                ${value !== null ? `<br><span class="font-mono bg-red-900/40 px-1 rounded">Lectura: ${value} ppm</span>` : ''}
                            </p>
                            <p class="text-xs text-red-300/70 mt-2">Acción: Suspender uso y revisar ductería inmediatamente.</p>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="p-4 bg-green-900/20 border border-green-500/50 rounded-xl flex items-start gap-4 animate-slide-up">
                        <div class="bg-green-500/20 p-2 rounded-full">
                            <i data-lucide="check-check" class="w-8 h-8 text-green-500"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-green-400">APROBADO</h3>
                            <p class="text-green-200 text-sm mt-1">
                                Sistema hermético y sin revoco detectado.
                                ${value !== null ? `<br><span class="font-mono bg-green-900/40 px-1 rounded">Lectura: ${value} ppm</span>` : ''}
                            </p>
                            <p class="text-xs text-green-300/70 mt-2">El sistema de evacuación opera correctamente bajo las condiciones de prueba.</p>
                        </div>
                    </div>
                `;
            }
            lucide.createIcons();
            
            // Scroll suave hacia el resultado
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

    </script>
</body>
</html>
